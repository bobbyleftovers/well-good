!function($){function e(e){var t=e.find(".mapbox-geojson-map"),i=e.find(".mapbox-geojson-field"),n={accessToken:t.attr("data-access-token"),mapId:t.attr("data-map-id")},o=function(e){$(i).val(e)},s={type:"FeatureCollection",features:[]};try{var r=JSON.parse($(i).val());s=r}catch(e){o(JSON.stringify(s))}if(n.accessToken&&n.mapId){var d=L.mapbox.map(t[0],n.mapId,n),l=L.mapbox.featureLayer(s,n).addTo(d);s.features.length?d.fitBounds(l.getBounds()):d.setView([t.attr("data-lat"),t.attr("data-long")],14);var c=new L.Control.Draw({draw:{polyline:{shapeOptions:{color:"#000000"}},polygon:{shapeOptions:{color:"#000000"}},marker:!0,circle:!1,rectangle:{shapeOptions:{color:"#000000"}}},edit:{featureGroup:l,edit:!1,remove:!1}}).addTo(d),p=a(e,d,l);d.on("draw:created",function(e){l.addLayer(e.layer),p.addLayerControl(e.layerType,e.layer)}).on("draw:created draw:edited draw:deleted sidebareditor:edited sidebareditor:deleted",function(e){o(JSON.stringify(l.toGeoJSON()))}).on("mouseover",function(e){p.hasBounced||p.isOpen||p.bounce()}),l.eachLayer(function(e){var a=!1;switch(e.feature.geometry.type){case"Point":a="marker";break;case"LineString":a="polyline";break;case"Polygon":a="polygon"}if(a){var t=p.addLayerControl(a,e);e.on("click",function(e){p.open(),t.enable()})}})}else console.log("mapbox-geojson-err-1")}function a(e,a,t){var i=e.find(".mbgs"),n=i.find(".mbgs-toggle"),o={domref:i,body:i.find(".mbgs-body"),isOpen:i.hasClass("mbgs-open"),map:a,featureGroup:t,hasBounced:!1,bounce:function(){this.hasBounced=!0},toggle:function(){this.domref.toggleClass("mbgs-open"),this.isOpen=this.domref.hasClass("mbgs-open"),this.isOpen||(this._disableEditing(),this.body.find(".mbgs-tray-item-active").removeClass("mbgs-tray-item-active"))},close:function(){this.domref.removeClass("mbgs-open"),this.isOpen=!1,this._disableEditing(),this.body.find(".mbgs-tray-item-active").removeClass("mbgs-tray-item-active")},open:function(){this.domref.addClass("mbgs-open"),this.isOpen=!0},_disableEditing:function(){this.layerControls.forEach(function(e){e._control.removeClass("mbgs-tray-item-active"),e._disableEdit()})},_panTo:function(e){if(this.isOpen){var t=this.map.project(e).add([125,0]),i=a.unproject(t);this.map.panTo(i)}else this.map.panTo(e)},_createTrayItem:function(e){var a="";return a+='<div class="mbgs-tray-item">',a+='   <a href="#" class="mbgs-tray-item-header">',a+='       <span class="ld-icon ld-icon-'+e+'"></span>',a+="       <span>"+e+"</span>",a+='       <span class="mbgs-delete-feature ld-icon ld-icon-trashcan"></span>',a+="   </a>",a+="</div>",$(a)},addLayerControl:function(e,a){var t=this,i={type:e,layer:a,map:t.map,sidebar:t,enabled:!1,enable:function(){this.sidebar._disableEditing(),this._enableEdit(),this._control.addClass("mbgs-tray-item-active"),this.enabled=!0},disable:function(){this._disableEdit(),this._control.removeClass("mbgs-tray-item-active"),this.enabled=!1},toggle:function(){this._control.toggleClass("mbgs-tray-item-active"),this.enabled?this.disable():this.enable()},_control:null,_enableEdit:function(){},_disableEdit:function(){},_init:function(){var e=this;"marker"==e.type?(e.layer.on("dragend",function(a){e.map.fire("sidebareditor:edited",e.layer)}),e._enableEdit=function(){e.sidebar._panTo(e.layer.getLatLng()),e.layer.dragging.enable()},e._disableEdit=function(){e.layer.dragging.disable()}):["polyline","polygon","rectangle"].indexOf(e.type)>-1&&(e.layer.on("edit",function(a){e.map.fire("sidebareditor:edited",e.layer)}),e.type="rectangle"==e.type?"polygon":e.type,e._enableEdit=function(){e.sidebar._panTo(e.layer.getBounds().getCenter()),e.layer.editing.enable()},e._disableEdit=function(){e.layer.editing.disable()});var t=e.sidebar._createTrayItem(e.type);return e.sidebar.body.append(t),e._control=t,t.find(".mbgs-tray-item-header").on("click",function(a){e.sidebar._disableEditing();var t=$(this).parent(".mbgs-tray-item");t.toggleClass("mbgs-tray-item-active"),t.hasClass("mbgs-tray-item-active")&&e._enableEdit()}),t.find(".mbgs-delete-feature").on("click",function(i){i.stopPropagation(),i.preventDefault(),e.sidebar.featureGroup.removeLayer(a),t.remove(),e.map.fire("sidebareditor:deleted",a)}),e}},n=i._init();return t.layerControls.push(n),n},layerControls:[]};return n.on("click",function(e){o.toggle()}),o}"undefined"!=typeof acf.add_action?acf.add_action("ready append",function(a){acf.get_fields({type:"mapbox_geojson"},a).each(function(){e($(this))})}):$(document).on("acf/setup_fields",function(a,t){$(t).find('.field[data-field_type="mapbox_geojson"]').each(function(){e($(this))})})}(jQuery);